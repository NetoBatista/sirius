
<div class="category-update-content">
    <div class="d-grid">
        <span>* Nome</span>
        <input placeholder="Streaming" maxlength="256" @bind-value="request.Name" />
    </div>
    <div class="d-grid">
        <span>Descrição</span>
        <textarea placeholder="Netflix + HBO + Amazon prime" rows="5" maxlength="1000" @bind="request.Description" />
    </div>
    <div class="d-flex category-update-action">
        <button class="btn-default" @onclick=OnClickClose>
            Cancelar
        </button>
        <button class="btn-default-action" @onclick=OnClickUpdate>
            Atualizar
        </button>
    </div>
</div>

@code {
    [Inject]
    private DialogProvider dialogProvider { get; set; } = default!;
    [Inject]
    private ICategoryService categoryService { get; set; } = default!;
    [Parameter]
    public CategoryRequestDTO request { get; set; } = default!;
    [Inject]
    private ToastProvider toastProvider { get; set; } = default!;

    private async Task OnClickUpdate()
    {
        try
        {
            if (string.IsNullOrEmpty(request.Name))
            {
                toastProvider.ShowToast("Nome da categoria é obrigatório", ToastLevelEnum.Error);
                return;
            }
            if (await categoryService.Exists(request))
            {
                toastProvider.ShowToast("Já existe uma categoria com esse nome", ToastLevelEnum.Error);
                return;
            }
            var response = await categoryService.Update(request);
            toastProvider.ShowToast("Atualizado com sucesso", ToastLevelEnum.Success);
            dialogProvider.CloseDialog(response);
        }
        catch (Exception)
        {
            toastProvider.ShowToast("Erro ao atualizar categoria", ToastLevelEnum.Error);
        }
    }

    private void OnClickClose()
    {
        dialogProvider.CloseDialog();
    }
}
